<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Hang Tags</title>
		<link rel="icon" type="image/x-icon" href="/assets/favicon-D52-HnyD.png" />
		<script type="module" crossorigin src="/assets/bootstrap.esm-CgEsG6e6.js"></script>
		<script type="module" crossorigin src="/assets/bootstrap-init-CxX6viQq.js"></script>
		<link rel="stylesheet" crossorigin href="/assets/bootstrap-BcD6Ynyg.css">
		<link rel="stylesheet" crossorigin href="/assets/hang-tags_index-8Y2XWPVh.css">
		<link rel="stylesheet" crossorigin href="/assets/style-B8YMWBVd.css">
	</head>
	<body class="hang-tags-body bg-dark dots-dark text-light">
		<div class="d-print-none">
			<div
				id="hangTagOptions"
				class="card shadow text-start p-4 rounded-4 bg-dark text-light border-1 border-secondary-subtle"
				style="
					width: 140px;
					position: fixed;
					top: 20px;
					right: 20px;
					backdrop-filter: blur(3px);
				">
				<div
					id="hangTagOptionsheader"
					class="w-100 text-center mb-2"
					style="cursor: move">
					<i class="bi bi-grip-horizontal text-secondary"></i>
					<i class="bi bi-grip-horizontal text-secondary"></i>
					<i class="bi bi-grip-horizontal text-secondary"></i>
				</div>
				<div class="d-flex flex-column align-items-start gap-2">
					<h6
						class="text-light h6 small text-center fw-bold d-none d-md-inline m-0">
						Options
					</h6>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="msrpCheckBox"
							checked />
						<label class="form-check-label small" for="msrpCheckBox"
							>MSRP</label
						>
					</div>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="savingsCheckBox"
							checked />
						<label class="form-check-label small" for="savingsCheckBox"
							>Savings</label
						>
					</div>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="rebatesCheckBox"
							checked />
						<label class="form-check-label small" for="rebatesCheckBox"
							>Rebates</label
						>
					</div>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="discountsCheckBox"
							checked />
						<label class="form-check-label small" for="discountsCheckBox"
							>Discounts</label
						>
					</div>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="feesCheckBox"
							checked />
						<label class="form-check-label small" for="feesCheckBox"
							>Fees</label
						>
					</div>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="photoCheckBox"
							checked />
						<label class="form-check-label small" for="photoCheckBox"
							>Photo</label
						>
					</div>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="descriptionCheckBox"
							checked />
						<label class="form-check-label small" for="descriptionCheckBox"
							>Desc</label
						>
					</div>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="qrCodeCheckBox"
							checked />
						<label class="form-check-label small" for="qrCodeCheckBox"
							>QR</label
						>
					</div>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="barCodeCheckBox"
							checked />
						<label class="form-check-label small" for="barCodeCheckBox"
							>Barcode</label
						>
					</div>

					<div class="form-check form-check-inline mb-0">
						<input
							class="form-check-input"
							type="checkbox"
							id="footerCheckBox"
							checked />
						<label class="form-check-label small" for="footerCheckBox"
							>Footer</label
						>
					</div>
				</div>
			</div>
		</div>

		<main class="container-fluid">
			<div class="main-content">
				<div class="hang-tags-preview" id="hangTagsPreview">
					<div class="tags-container" id="hangTagsContainer">
						<div class="tag-left"></div>
						<div class="tag-right"></div>
					</div>
				</div>
			</div>
		</main>

		<div
			class="d-print-none"
			style="position: fixed; bottom: 20px; right: 20px">
			<div class="btn-group h5 mx-2">
				<button
					type="button"
					class="btn btn-secondary"
					id="zoomOutBtn"
					title="Zoom out">
					<i class="bi bi-zoom-out ms-1"></i>
				</button>
				<button
					type="button"
					class="btn btn-secondary"
					id="zoomResetBtn"
					title="Fit to screen">
					Fit
				</button>
				<button
					type="button"
					class="btn btn-secondary"
					id="zoomInBtn"
					title="Zoom in">
					<i class="bi bi-zoom-in me-1"></i>
				</button>
			</div>
		</div>

		<script src="../js/jsBarcode.all.min.js"></script>
		<script src="../js/qrcode.min.js"></script>
		<script src="../js/numeral.js"></script>
		<script src="../js/moment.js"></script>
		<script src="../js/xml-cache.js"></script>
		<script src="./hang-tag.js"></script>
		<script>
			// Draggable element function (called in DOMContentLoaded)

			function dragElement(elmnt) {
				var pos1 = 0,
					pos2 = 0,
					pos3 = 0,
					pos4 = 0;
				if (document.getElementById(elmnt.id + "header")) {
					/* if present, the header is where you move the DIV from:*/
					document.getElementById(elmnt.id + "header").onmousedown =
						dragMouseDown;
				} else {
					/* otherwise, move the DIV from anywhere inside the DIV:*/
					elmnt.onmousedown = dragMouseDown;
				}

				function dragMouseDown(e) {
					e = e || window.event;
					e.preventDefault();
					// get the mouse cursor position at startup:
					pos3 = e.clientX;
					pos4 = e.clientY;
					document.onmouseup = closeDragElement;
					// call a function whenever the cursor moves:
					document.onmousemove = elementDrag;
				}

				function elementDrag(e) {
					e = e || window.event;
					e.preventDefault();
					// calculate the new cursor position:
					pos1 = pos3 - e.clientX;
					pos2 = pos4 - e.clientY;
					pos3 = e.clientX;
					pos4 = e.clientY;
					// set the element's new position:
					elmnt.style.top = elmnt.offsetTop - pos2 + "px";
					elmnt.style.left = elmnt.offsetLeft - pos1 + "px";
				}

				function closeDragElement() {
					/* stop moving when mouse button is released:*/
					document.onmouseup = null;
					document.onmousemove = null;
				}
			}
			/**
			 * Apply zoom to the hang tags preview.
			 * @param {number} scale Zoom scale value.
			 */
			function applyHangTagsZoom(scale) {
				const container = document.getElementById("hangTagsContainer");
				if (!container) return;
				if (
					window.CSS &&
					window.CSS.supports &&
					window.CSS.supports("zoom: 1")
				) {
					container.style.zoom = scale;
					container.style.transform = "";
				} else {
					container.style.zoom = "";
					container.style.transform = `scale(${scale})`;
					container.style.transformOrigin = "top center";
				}
				container.setAttribute("data-zoom", scale.toFixed(2));
			}

			/**
			 * Calculate a fit-to-screen zoom value.
			 * @returns {number} Zoom scale.
			 */
			function getHangTagsFitZoom() {
				const container = document.getElementById("hangTagsContainer");
				if (!container) return 1;
				if (!container.dataset.baseWidth || !container.dataset.baseHeight) {
					const rect = container.getBoundingClientRect();
					container.dataset.baseWidth = rect.width;
					container.dataset.baseHeight = rect.height;
				}
				const header = document.querySelector("header");
				const headerHeight = header ? header.offsetHeight : 0;
				const padding = 32;
				const availableWidth = window.innerWidth - padding * 2;
				const availableHeight = window.innerHeight - headerHeight - padding * 2;
				const baseWidth =
					parseFloat(container.dataset.baseWidth) || availableWidth;
				const baseHeight =
					parseFloat(container.dataset.baseHeight) || availableHeight;
				const scale = Math.min(
					availableWidth / baseWidth,
					availableHeight / baseHeight,
				);
				return Math.max(0.1, Math.min(1.2, scale));
			}

			/**
			 * Initialize zoom controls for hang tags.
			 */
			function initHangTagsZoom() {
				const zoomOutBtn = document.getElementById("zoomOutBtn");
				const zoomResetBtn = document.getElementById("zoomResetBtn");
				const zoomInBtn = document.getElementById("zoomInBtn");
				if (!zoomOutBtn || !zoomResetBtn || !zoomInBtn) return;

				let currentZoom = getHangTagsFitZoom();
				applyHangTagsZoom(currentZoom);

				zoomOutBtn.addEventListener("click", () => {
					currentZoom = Math.max(0.1, currentZoom - 0.05);
					applyHangTagsZoom(currentZoom);
				});
				zoomInBtn.addEventListener("click", () => {
					currentZoom = Math.min(1.5, currentZoom + 0.05);
					applyHangTagsZoom(currentZoom);
				});
				zoomResetBtn.addEventListener("click", () => {
					currentZoom = getHangTagsFitZoom();
					applyHangTagsZoom(currentZoom);
				});

				window.addEventListener("resize", () => {
					currentZoom = getHangTagsFitZoom();
					applyHangTagsZoom(currentZoom);
				});
			}

			/**
			 * Toggle element visibility based on checkbox.
			 * @param {string} checkboxId - Checkbox element ID.
			 * @param {string} elementId - Element to toggle.
			 */
			function toggleVisibility(checkboxId, elementId) {
				const checkbox = document.getElementById(checkboxId);
				const element = document.getElementById(elementId);
				if (!checkbox || !element) return;

				if (checkbox.checked) {
					element.classList.remove("ht-hidden");
				} else {
					element.classList.add("ht-hidden");
				}
			}

			/**
			 * Initialize visibility toggle handlers.
			 */
			function initVisibilityToggles() {
				const toggles = [
					{ checkbox: "msrpCheckBox", element: "msrpLine" },
					{ checkbox: "savingsCheckBox", element: "savingsLine" },
					{ checkbox: "rebatesCheckBox", element: "rebatesLine" },
					{ checkbox: "discountsCheckBox", element: "discountsLine" },
					{ checkbox: "feesCheckBox", element: "feesLine" },
					{ checkbox: "photoCheckBox", element: "photoLine" },
					{ checkbox: "descriptionCheckBox", element: "descriptionLine" },
					{ checkbox: "qrCodeCheckBox", element: "qrcode" },
					{ checkbox: "barCodeCheckBox", element: "barcode" },
				];

				toggles.forEach(({ checkbox, element }) => {
					const checkboxEl = document.getElementById(checkbox);
					if (checkboxEl) {
						checkboxEl.addEventListener("change", () =>
							toggleVisibility(checkbox, element),
						);
					}
				});

				// Footer has two elements
				const footerCheckbox = document.getElementById("footerCheckBox");
				if (footerCheckbox) {
					footerCheckbox.addEventListener("change", () => {
						const leftFooter = document.getElementById("footerLineLeft");
						const rightFooter = document.getElementById("footerLineRight");
						if (footerCheckbox.checked) {
							leftFooter?.classList.remove("ht-hidden");
							rightFooter?.classList.remove("ht-hidden");
						} else {
							leftFooter?.classList.add("ht-hidden");
							rightFooter?.classList.add("ht-hidden");
						}
					});
				}
			}

			/**
			 * Initialize hang tags on page load.
			 */
			document.addEventListener("DOMContentLoaded", () => {
				// Get stock number from URL
				const urlParams = new URLSearchParams(window.location.search);
				const stockNumber = urlParams.get("search");

				// Make options panel draggable
				dragElement(document.getElementById("hangTagOptions"));

				// Initialize zoom
				initHangTagsZoom();

				// Initialize visibility toggles
				initVisibilityToggles();

				// Load hang tags if stock number provided
				if (stockNumber && window.HangTagComponent) {
					window.HangTagComponent.load(stockNumber);
				} else {
					// Show placeholders
					window.HangTagComponent?.clear(".tag-left");
					window.HangTagComponent?.clear(".tag-right");
				}
			});
		</script>
	</body>
</html>
